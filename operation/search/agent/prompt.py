from langchain.prompts import ChatPromptTemplate, PromptTemplate

class PromptChain:
    def __init__(self):

        self.report_prompt = ChatPromptTemplate.from_messages([
            ("system", "당신은 사용자 질문을 검색하여 내용을 정리하는 검색 전문 리서처 입니다."),
            ("user", """아래 검색된 내용을 전체적으로 분석한 후 정리하세요. 각 유형의 정의는 다음과 같습니다. 
            
            다음 지침을 반드시 따라주세요:
            1. 답변은 반드시 한국어로 작성해야 합니다.  
            2. 문서의 주요 내용을 항목별로 정리하여 답변하세요. 
            3. documents에 있는 정보만을 사용해야 하며, 추측하거나 새로운 정보를 생성하지 마세요.
            4. 가능한 경우 원문의 문장을 유지하여 정보를 전달하세요.  
            5. 불확실한 내용이 포함된 경우, `추가 정보가 필요합니다.`라고 답변하세요.  
            6. 질문에 대한 명확한 답변을 제공할 수 없으면, '주어진 정보로는 답변하기 어렵습니다.'라고만 말하세요.  
            7. 답변은 간결하고 명확하게 작성해야 합니다. 
            
            [검색 결과]
            {document}
            """)
        ])

        self.validation_prompt = ChatPromptTemplate.from_messages([
            ("system", "당신은 researcher 에이전트에게 전달받은 내용을 검토하는 검토 전문가입니다."),
            ("user", """아래는 리서처 에이전트가 작성한 요약 내용입니다. 다음 항목을 기준으로 해당 내용을 검토하고 평가하세요:

        - 정보 출처: 요약 내용이 주어진 documents의 정보에 기반했는가?
        - 정확성: 불확실한 내용을 추측하지 않고, 지침에 따라 '추가 정보가 필요합니다.' 또는 '주어진 정보로는 답변하기 어렵습니다.'라고 적절히 표기했는가?
        - 명확성: 항목별로 내용을 간결하고 명확하게 정리했는가?
        - 문장 구성: 가능한 경우 원문 문장을 유지하였는가?

        지침:
        1. 반드시 한국어로 작성하세요.
        2. 각 항목에 대해 '적절함' 또는 '부적절함'으로 평가한 후 간단한 피드백을 작성하세요.
        3. 전반적인 평가와 함께 수정이 필요한 경우 간단한 수정 제안도 포함하세요.

        그리고 최종적으로 다음 형식의 JSON으로 결과를 반환하세요:
        - score: "1" (적절함) 또는 "0" (부적절함)
        - improved_prompt: 개선된 질문 (관련성이 낮은 경우에만 작성, 관련성이 높으면 빈 문자열)

        형식 예시:
        {{
          "score": "1",
          "improved_prompt": ""
        }}

        [리서처 요약 내용]
        {report}
        """)
        ])